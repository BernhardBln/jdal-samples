<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:util="http://www.springframework.org/schema/util"
	default-init-method="init" default-lazy-init="true"
	xmlns:swing="http://www.jdal.org/schema/swing"
	xsi:schemaLocation="http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
		http://www.jdal.org/schema/swing http://www.jdal.org/schema/jdal/jdal-swing.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.1.xsd
		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.1.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd">


	<swing:defaults />
	
	<!--  Control Accessor Facotry that map classes to accesors -->
	<bean id="controlAccessorFactory" class="info.joseluismartin.gui.bind.ConfigurableControlAccessorFactory">
		<property name="accessors">
			<map key-type="java.lang.Class" value-type="java.lang.Class">
				<entry key="javax.swing.JComboBox" value="info.joseluismartin.gui.bind.ComboAccessor"/>
				<entry key="javax.swing.text.JTextComponent" value="info.joseluismartin.gui.bind.TextComponentAccessor"/>
				<entry key="javax.swing.JToggleButton" value="info.joseluismartin.gui.bind.ToggleButtonAccessor"/>
				<entry key="javax.swing.JList" value="info.joseluismartin.gui.bind.ListAccessor"/>
				<entry key="info.joseluismartin.gui.Selector" value="info.joseluismartin.gui.bind.SelectorAccessor"/>
				<entry key="org.freixas.jcalendar.JCalendarCombo" value="org.jdal.samples.bind.JCalendarComboAccessor"/>
			</map>
		</property>
	</bean>
	
	 <!-- Abstract bean definition for Views -->
      <bean id="view" abstract="true">
          <property name="binderFactory" ref="binderFactory"/>
          <property name="autobinding" value="true"/>
          <property name="messageSource" ref="messageSource"/>
          <property name="controlAccessorFactory" ref="controlAccessorFactory"/>
          <property name="errorProcessors">
                  <list>
                          <bean class="info.joseluismartin.gui.validation.BackgroundErrorProcessor" />
                   </list>
         </property>
      </bean>
	
	
	<!-- Spring JSR-303 validator -->
	<bean id="validator" class="org.springframework.validation.beanvalidation.LocalValidatorFactoryBean" />
	
	<bean id="listPanel" class="info.joseluismartin.gui.ListPane">
		<property name="panels">
			<list value-type="info.joseluismartin.gui.PanelHolder">
				<bean class="info.joseluismartin.gui.JComponentPanelHolder">
					<property name="name" value= "Books"/>
					<property name="component" ref="bookTable"/>
				</bean>
				<bean class="info.joseluismartin.gui.ViewPanelHolder">
					<property name="view" ref="authorEditor"/>
				</bean>
				<bean class="info.joseluismartin.gui.ViewPanelHolder">
					<property name="view" ref="categoryEditor"/>
				</bean>
			</list>
		</property>
	</bean>
	
	<swing:table entity="org.jdal.samples.library.model.Book" filterView="filterView">
		<swing:columns>
			<swing:column name="name"     displayName="Name"/>
			<swing:column name="author"   displayName="Author"   sortProperty="author.name"/>
			<swing:column name="category" displayName="Category" sortProperty="category.name" />
			<swing:column name="isbn"     displayName="ISBN" />
		</swing:columns>
	</swing:table>
	
	
   <!-- Abstract bean definition for TableEditors -->
   <bean id="tableEditor" abstract="true" parent="view">
       <property name="addIcon" value="/images/table/22x22/add.png"/>
       <property name="saveIcon" value="/images/table/22x22/save.png"/>
       <property name="removeIcon" value="/images/table/22x22/remove.png"/>
   </bean>
	
	
	<bean id="authorEditor" class="info.joseluismartin.gui.TableEditor" parent="tableEditor">
		<constructor-arg value="org.jdal.samples.library.model.Author"/>
		<property name="name" value="Authors"/>
		<property name="tableModel" ref="authorTableModel"/>
		<property name="service" ref="authorService"/>
	</bean>
	
	
	<bean id="categoryEditor" class="info.joseluismartin.gui.TableEditor" parent="tableEditor">
		<constructor-arg value="org.jdal.samples.library.model.Category"/>
		<property name="name" value="Categories"/>
		<property name="tableModel" ref="categoryTableModel"/>
		<property name="service" ref="categoryService"/>
	</bean>
	
	<bean id="authorTableModel" class="info.joseluismartin.gui.ListTableModel">
		<property name="modelClass" value="org.jdal.samples.library.model.Author"/>
		<property name="columns">
			<list value-type="info.joseluismartin.gui.ColumnDefinition">
				<bean class="info.joseluismartin.gui.ColumnDefinition">
					<property name="name" value="name"/>
					<property name="displayName" value="Name"/>
					<property name="editable" value="true"/>
				</bean>
				<bean class="info.joseluismartin.gui.ColumnDefinition">
					<property name="name" value="surname"/>
					<property name="displayName" value="Surname"/>
					<property name="editable" value="true"/>
				</bean>
			</list>
		</property>
		<property name="usingChecks" value="false"/>
	</bean>
	
	<bean id="categoryTableModel" class="info.joseluismartin.gui.ListTableModel">
		<property name="modelClass" value="org.jdal.samples.library.model.Category"/>
		<property name="columns">
			<list value-type="info.joseluismartin.gui.ColumnDefinition">
				<bean class="info.joseluismartin.gui.ColumnDefinition">
					<property name="name" value="name"/>
					<property name="displayName" value="Name"/>
					<property name="editable" value="true"/>
				</bean>
			</list>
		</property>
		<property name="usingChecks" value="false"/>
	</bean>
	
	

	<bean id="filterView" class="org.jdal.samples.library.ui.BookFilterView" parent="view">
		<property name="categoryService" ref="categoryService"/>
	</bean>
	
	<bean id="bookView" class="org.jdal.samples.library.ui.BookView" scope="prototype" parent="view">
		<property name="authorService" ref="authorService"/>
		<property name="categoryService" ref="categoryService"/>
		<property name="authorEditor" value="authorDialog"/>
		<property name="guiFactory" ref="defaultGuiFactory"/>
		<!-- inject a custom spring validator -->
		<property name="validator" ref="bookValidator"/>
	</bean>
	
	<bean id="bookValidator" class="org.jdal.samples.library.ui.BookValidator"/>
	
	<bean id="authorView" class="org.jdal.samples.library.ui.AuthorView" scope="prototype" parent="view">
		<!--  inject the spring validator factory bean to use the jsr 303 validation on views -->
		<property name="validator" ref="validator" />
	</bean>
	
	<bean id="authorDialog" class="info.joseluismartin.gui.ViewDialog" scope="prototype">
		<property name="view" ref="authorView"/>
		<property name="acceptAction" ref="acceptAction"/>
		<property name="cancelAction" ref="cancelAction"/>
	</bean>
	
	<bean id="bookEditor" class="info.joseluismartin.gui.ViewDialog" scope="prototype">
		<property name="view" ref="bookView"/>
		<property name="acceptAction" ref="acceptAction"/>
		<property name="cancelAction" ref="cancelAction"/>
		<property name="dialogWidth" value="5	00"/>
		<property name="dialogHeight" value="300"/>
	</bean>
	
	<bean id="acceptAction" class="info.joseluismartin.gui.action.ViewSaveAction" scope="prototype">
		<property name="icon" value="/images/16x16/dialog-ok.png"/>
		<property name="service" ref="persistentService"/>
		<property name="name" value="Accept"/>
	</bean>
	
	<bean id="cancelAction" class="info.joseluismartin.gui.action.DialogCancelAction" scope="prototype">
		<property name="icon" value="/images/16x16/dialog-cancel.png"/>
		<property name="name" value="Cancel"/>
	</bean>
	
	
</beans>